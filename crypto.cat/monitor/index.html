<!DOCTYPE html>
<head>
	<meta charset="UTF-8" />
	<title>Cryptocat Network Monitor</title>
	<style type="text/css">
		body {
			background: #97CEEC;
			color: #FFF;
			font-family: sans-serif;
		}
		div#chart {
			margin: 40px auto 0 auto;
			display: block;
			width: 1000px;
			height: 450px;
		}
		div#header {
			width: 560px;
			margin: 0 auto;
			display: block;
		}
		img#logo {
			width: 80px;
			height: auto;
			float: left;
		}
		span#title {
			vertical-align: -32px;
			margin-left: 20px;
			font-size: 30px;
			font-weight: bold;
		}
		span#subtitle {
			display: block;
			position: relative;
			left: 22px;
			vertical-align: 10px;
			font-size: 18px;
			font-weight: bold;
			color: rgba(255, 255, 255, 0.65);
			font-variant: small-caps;
		}
		p#info {
			text-align: center;
			padding: 10px;
			background: rgba(0, 0, 0, 0.6);
			border-radius: 5px 0 5px 5px;
			width: 450px;
			margin: 10px auto 0 auto;
			font-size: 14px;
		}
		span.small {
			font-size: 12px;
		}
	</style>
	<script type="application/javascript" src="../js/jquery.js"></script>
	<script type="application/javascript" src="js/chart.js"></script>
	<script type="application/javascript">
		$(window).load(function() {
	
		var x = []
		var y = []
		
		var chartOptions = {
			scaleOverride: true,
			scaleSteps: 12,
			scaleStartValue: 0,
			scaleStepWidth: 30,
			scaleFontSize: 10,
			scaleFontColor: '#FFF',
			scaleFontStyle: 'bold',
			pointDotRadius: 4
		}
		
		function updateChart() {
			$.get('c.txt', function(data) {
				x = []
				y = []
				data = data.split('\n')
				data.splice(data.length - 1, 1)
				for (var i in data) {
					x.push(convertUnixTime(parseInt(data[i].match(/^\d+/)[0])))
					y.push(data[i].match(/\d+$/)[0])
				}
				generateChart(x, y)
			})
		}
		
		function convertUnixTime(unixTime) {
			var date = new Date(unixTime * 1000);
			var minutes = (date.getMinutes()).toString()
			if (minutes.length === 1) {
				minutes = '0' + minutes
			}
			return (date.getHours()) + ':' + minutes
		}
	
		function generateChart(l, d) {
			var data = {
				labels: l,
				datasets: [
					{
						fillColor: 'rgba(20, 100, 150, 0.4)',
						strokeColor: '#FFF',
						pointColor: 'rgba(151,187,205,1)',
						pointStrokeColor: '#FFF',
						data: d
					}
				]
			}
			$('div#chart').html('<canvas id="myChart" width="1000" height="450"></canvas>')
			var ctx = $('canvas#myChart').get(0).getContext('2d')
			var myChart = new Chart(ctx).Line(data, chartOptions)
		}
		
		window.setInterval(function() {
			updateChart()
		}, 300000)
		updateChart()
		
		})
	</script>
</head>
<body>
	<div id="header">
		<img src="../img/logo.png" alt="Cryptocat" id="logo" />
		<span id="title">Cryptocat Network Monitor</span>
		<span id="subtitle">current active cryptocat users</span>
	</div>
	<div id="chart"></div>
	<p id="info">
		<strong>Graph updates every five minutes.</strong><br />
		<span class="small">
			Statistics cover the last eight hours.<br />
			Third-party Cryptocat networks are not included.
		</span>
	</p>
</body>
</html>